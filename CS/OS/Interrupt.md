# Interrupt(인터럽트)

: 프로그램을 실행하는 도중에 예기치 않은 상황이 발생할 경우 현재 실행 중인 작업을 즉시 중단하고 발생한 상황에 대한 우선 처리가 필요함을 마이크로프로세서에게 알리는 것. 현재 수행 중인 일보다 더 중요한 일(ex. 입출력, 우선 순위 연산 등)이 발생하면 그 일을 먼저 처리하고 나서 하던 일을 계속해야함.

- 외부 / 내부 인터럽트는 `CPU의 하드웨어 신호에 의해 발생`
- 소프트웨어 인터럽트는 `명령어의 수행에 의해 발생`

### 외부 인터럽트
입출력 장치, 타이밍 장치, 전원 등 외부적인 요인으로 인해 발생
- `전원 이상, 기계 착오, 외부 신호, 입출력`

### 내부 인터럽트
Trap이라고 부르며, 잘못된 명령이나 데이터를 사용할 때 발생
- `0으로 나누기, 오버플로우, 명령어 잘못 사용` 등 (Exception)

### 소프트웨어 인터럽트
프로그램 처리 중 명령의 요청에 의해 발생 (SCV 인터럽트)
- 사용자가 프로그램을 실행시킬 때 발생
- 소프트웨어 이용 중에 다른 프로세스를 실행시키면 시분할 처리를 위해 자원 할당 동작이 수행됨

## 💊 인터럽트 처리 과정

![인터럽트 처리 과정](https://mblogthumb-phinf.pstatic.net/20160310_124/scw0531_14575366291105WjS7_PNG/ERTRTETRE.png?type=w2)

process A 실행 중 디스크에서 어떤 데이터를 읽어오라는 명령을 받았다고 가정해보자.
- process A는 `system call`을 통해 인터럽트를 발생시킨다.
- CPU는 현재 진행 중인 기계어 코드를 완료한다.
- 현재까지 수행 중이었던 상태를 해당 process의 PCB(Process Control Block)에 저장한다. (수행 중이던 메모리 주소, 레지스터 값, 하드웨어 상태 등등..)
- PC(Program Counter, IP)에 다음에 실행할 명령의 주소를 저장한다.
- 인터럽트 벡터를 읽고 ISR(Interrupt Service Routine) 주소값을 얻어 ISR로 점프하여 루틴을 실행한다.
- 해당 코드를 실행한다.
- 처리하고 나면 대피시킨 레지스터를 복원한다.
- ISR의 끝에 IRET 명령어에 의해 인터럽트가 해제 된다.
- IRET 명령어가 실행되면, 대피시킨 PC 값을 복원하여 이전 실행 위치로 복원한다.

만약 인터럽트 기능이 없었다면, 폴링(Polling) 기법
- 인터럽트 방식 & 폴링 방식 (컨트롤러가 우선순위를 판별하는 법)
  - 폴링 방식
    - 사용자가 명령어를 사용해 입력 핀의 값을 계속 읽어 변화를 알아내는 방식
    - 인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트 자원을 찾아 이에 맞는 인터럽트 서비스 루틴을 수행 (하드웨어에 비해 속도가 느림)
  - 인터럽트 방식
    - MCU 자체가 하드웨어적으로 신호를 확인하여 변화 시에만 일정한 동작을 하는 방식
  - 인터럽트 방식은 하드웨어 지원을 받아야 하는 제약이 있지만 폴링에 비해 신속하게 대응할 수 있음. 실시간 대응이 필요할 때는 필수적인 기능.
  - 즉, 인터럽트는 발생시기를 예측하기 힘든 경우에 컨트롤러가 가장 빠르게 대응할 수 있는 방법

#### 참고
<https://gyoogle.dev/blog/computer-science/operating-system/Interrupt.html>

<https://velog.io/@adam2/%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8>

인터럽트 vs 폴링 <https://kkhipp.tistory.com/155>